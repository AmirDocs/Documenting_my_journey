# **TERRAFORM FUNDAMENTALS**

*For Terraform - Documentation is vital. Use the status code to troubleshoot an error*

## Format

`import aws_instance.web i-12345678`

- Action: import
- Instance type: AWS
- Resource name: Anything. "Web" for this example.
- Instance ID: 12345678

## **Terraform State File (THE BLUEPRINT)**:
The Terraform State File is a record of your existing infrastructure. Its a upto date record of your actual state. This is really important and helps ensure idempotency. With idempotency, no matter how many times you run your terraform configuration, it will produce the same result. If a particular change is made to your configuration it will just apply that particular change.

### **Desired vs Current State**:

**Desired State .tf**: Your configuration, changes your trying to implement or deploy (What your trying to achieve).
**Current State .tfstate**: Your current terraform State File is your upto date record of your infrastructure (What actually exists).

## **Terraform providers**:
A Terraform provider is a plugin that allows you to interact with Cloud Platforms, services or other technologies. You can manage resources, security, repos and databases with AWS, Azure, Kubernetes, Cloudflare, Github and other providers.

## **Terraform Commands**:

**`terraform init`**

This is the file command you run in any new or exisiting terraform project. 
- *initializing the backend...* State of your infrastructure to track resources properly and allow that idempotency.
- *initializing proivder plugins...* Downloads provider. Terraform  look at your configuration to identify what provider you need (refer to provider block).

**`terraform plan`**

Previewing the changes terraform will make before they happen. Terraform plan allows you to see what your changes will do. Terraform analysis your configuration files, compares them to the current state of your infrastructure and then generates a plan. The output represents your **desired state**.

| Resource | Description |
| --- | --- |
| `+` | Create |
| `~` | Update in-place |
| `-` | Destroy |

**`terraform apply`**

Terraform apply takes the execution plan generated by terraform plan and applies it to your infrastructure. After these changes are made, terraform will update the state file to reflect your current state of infrastructure, to maintain idempotency.

**`terraform destroy`**

Terraform destroy is a conveninent way to destroy all remote objects managed by a particular Terraform configuration. It allows you to safely remove all infrastucture managed by your terraform configuration on the cloud. Will prompt you Y/N.

## **Resource Block**:

In Terraform, a resource block is used to define a piece of infrastructure you want to manage. 
```
Resource "aws_instance" "Test" {
  ami           = "ami-12345678"  # Replace with a valid AMI ID
  instance_type = "t2.micro"      # Change as needed

Tags = {
Name = "hello world"
}
}
```

Resource = the type (aws) and name (Test)
ami = The amazon machine image or template for your EC2 instance determining the operating system (ubuntu etc.)
Instance type = (Example t2.micro)
Tags = Attribute or way to categorize resources. Not important.

## **Terraform Registry/ Provider Block**:

Initialize terraform backend with a provider block. This can be found in terraform Documentation for the specific provider (AWS etc.)
In Terraform, initializing the backend refers to setting up the storage location where Terraform will keep its state file (the file that records information about your infrastructure's current state). This process, known as `terraform init`, configures the backend to allow Terraform to manage the infrastructure consistently, whether the state is stored locally or in a remote location (AWS S3, Google Cloud Storage, HashiCorp Consul etc.). 

## **STEPS: Creating an EC2 instance**

1) Type *ec2* in Terraform Registry (Documentation)
2) Select *aws_instance* from the dropdown 
  - **Example Usage**: Examples on how to use them.
  - **Argument Reference**: Will show you resources that are *required* and *Optional*.
  - **import**: To import an exisiting resource into your terraform code.
3) `ami ID` can be found on AWS "Launch an instance" for your specific instance.
4) Terraform knows which account to deploy things in with an Access key on AWS. An IAM user will have to click their profile and select *Local Code* to show this. No tag value is neccesary.
5) Export the Access Key with:
```
export AWS_ACCESS_KEY_ID="your_access_key_id"

export AWS_SECRET_ACCESS_KEY="your_secret_access_key"

export AWS_DEFAULT_REGION="your_default_region"
```
Once exported, run a `Terraform plan` to obtain your desired state and `terraform apply`. 
6) When `terraform plan` is ran, the last output should be **No changes. Your infrastructure matches the configuration**

